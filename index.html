<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>NetGuet Pro</title>
    <style>
        :root { --bg: #36393f; --side: #2f3136; --text: #dcddde; --accent: #5865f2; }
        body { background: var(--bg); color: var(--text); font-family: 'Helvetica', sans-serif; margin: 0; display: flex; height: 100vh; }
        
        /* Formulaire de connexion */
        #auth-screen { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 100; }
        .auth-box { background: var(--side); padding: 30px; border-radius: 8px; width: 300px; box-shadow: 0 8px 16px rgba(0,0,0,0.2); }
        
        /* Chat */
        #main-app { display: none; width: 100%; height: 100%; flex-direction: row; }
        .sidebar { width: 240px; background: var(--side); padding: 20px; }
        .chat-area { flex: 1; display: flex; flex-direction: column; }
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; }
        
        .msg { margin-bottom: 15px; }
        .msg b { color: #fff; margin-right: 10px; }
        
        input { background: #40444b; border: none; color: #fff; padding: 12px; border-radius: 5px; width: 100%; margin-bottom: 10px; box-sizing: border-box;}
        button { background: var(--accent); color: #fff; border: none; padding: 12px; border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold; }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="auth-box">
        <h2 style="text-align:center">Bienvenue</h2>
        <input type="text" id="reg-pseudo" placeholder="Pseudo">
        <input type="email" id="reg-email" placeholder="Email">
        <input type="password" id="reg-mdp" placeholder="Mot de passe">
        <button onclick="creerCompte()">Créer mon compte</button>
    </div>
</div>

<div id="main-app">
    <div class="sidebar"><h3>NetGuet</h3><p># général</p></div>
    <div class="chat-area">
        <div id="messages"></div>
        <div style="padding: 20px;">
            <input type="text" id="msg-input" placeholder="Envoyer un message..." onkeypress="if(event.key==='Enter') envoyer()">
        </div>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    let monPseudo = localStorage.getItem('pseudo');

    if(monPseudo) { afficherApp(); }

    async function creerCompte() {
        const pseudo = document.getElementById('reg-pseudo').value;
        const email = document.getElementById('reg-email').value;
        const mdp = document.getElementById('reg-mdp').value;
        
        if(!pseudo || !email || !mdp) return alert("Remplis tout !");
        
        const res = await fetch('/register', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({pseudo, email, mdp})
        });
        
        if(res.ok) {
            localStorage.setItem('pseudo', pseudo);
            location.reload();
        }
    }

    function afficherApp() {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'flex';
    }

    function envoyer() {
        const text = document.getElementById('msg-input').value;
        if(text) {
            socket.emit('chat_message', { user: monPseudo, text: text });
            document.getElementById('msg-input').value = '';
        }
    }

    socket.on('chat_message', (data) => {
        const div = document.createElement('div');
        div.className = "msg";
        div.innerHTML = `<b>${data.user}</b> <span>${data.text}</span>`;
        document.getElementById('messages').appendChild(div);
        document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
    });

    socket.on('load_history', (msgs) => {
        msgs.forEach(m => {
            const div = document.createElement('div');
            div.className = "msg";
            div.innerHTML = `<b>${m.user}</b> <span>${m.text}</span>`;
            document.getElementById('messages').appendChild(div);
        });
    });
</script>
</body>
</html>
